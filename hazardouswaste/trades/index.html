<!DOCTYPE html>
<html>
  <head>
    <title>trades</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
    <script type='text/javascript' src="http://code.jquery.com/jquery-2.1.4.min.js"> </script>
    <link type="text/css" rel="stylesheet" href="force.css"/>
  </head>
  <body>
	<h3>North American Hazardous Waste Trading Networks</h3>
  <div id="chart"></div>
<!--   <script>

    d3.csv("trades.csv", function(data){
      var shell = {"nodes": [], "links": []}
      var names = []
      data.forEach(function(d){
        names.push(d.source);
        names.push(d.target);
      })
      uniqueArray = names.filter(function(item, pos) {
        return names.indexOf(item) == pos;
      })
      uniqueArray.forEach(function(d){
        var a = uniqueArray.indexOf(d)
        shell["nodes"].push({"index": a, "name": d})
      })
      var rollup =  d3.nest()
        .key(function(d) {return d.source})
        .key(function(d) {return d.target})
        .rollup(function(leaves) { return leaves.length })
        .map(data);
      uniqueArray.forEach(function(d){
        var thisData = rollup[d]
        var keys = d3.keys(thisData)
        var values = d3.values(thisData)
        for (var i = 0; i<keys.length; i++){
          //find index
          var index = shell["nodes"].filter(function(n){return n.name == d})
          index = index[0]["index"]

          //target index
          var Tindex = shell["nodes"].filter(function(n){return n.name == keys[i]})
          Tindex = Tindex[0]["index"]          
          //push
          shell["links"].push({"source": index, "target": Tindex, "value": values[i]})
        } 
      })
      var string = JSON.stringify(shell, null, 1)
      d3.select("#chart").append('text').text(string)
    })


  </script> -->
  <script src='trades.js'></script>

  </body>
</html>
